<div class="container">
    <div class="header">
        <h2>Gerenciar Orçamentos</h2>
        <app-button-float appearance="primary" size="l" (click)="openFormModal()">
            Novo Orçamento
        </app-button-float>
    </div>

    <div class="content" *ngIf="!isLoading()">
        <div class="table-container">
            <table tuiTable size="l">
                <thead>
                    <tr>
                        <th tuiTh>Período</th>
                        <th tuiTh>Descrição</th>
                        <th tuiTh>Total de Itens</th>
                        <th tuiTh>Receitas</th>
                        <th tuiTh>Despesas</th>
                        <th tuiTh>Ações</th>
                    </tr>
                </thead>
                <tbody tuiTbody>
                    <tr *ngFor="let orcamento of orcamentos; trackBy: trackByFn">
                        <td tuiTd>
                            <tui-badge appearance="info" iconStart="@tui.calendar">
                                {{ orcamento.periodo | formatPeriod }}
                            </tui-badge>
                        </td>
                        <td tuiTd>{{ orcamento.descricao }}</td>
                        <td tuiTd>
                            <tui-badge appearance="neutral" (click)="openFormItensModal(orcamento)"
                                [style.cursor]="'pointer'">
                                {{ orcamento.items.length || 0 }} item(s)
                            </tui-badge>
                        </td>
                        <td tuiTd class="currency positive" (click)="openFormItensModal(orcamento)" [style.cursor]="'pointer'">
                            {{ getTotalReceitas(orcamento) | currency }}
                        </td>
                        <td tuiTd class="currency negative" (click)="openFormItensModal(orcamento)" [style.cursor]="'pointer'">
                            -{{ getTotalDespesas(orcamento) | currency }}
                        </td>
                        <td tuiTd class="actions">
                            <button tuiButton appearance="secondary" size="s" (click)="openFormItensModal(orcamento)">
                                <tui-icon icon="@tui.list-checks" [style.height.rem]="1" appearance="secondary"
                                    tuiTooltip="Editar detalhes do orçamento" aria-label="Editar detalhes do orçamento" />
                            </button>
                            <button tuiButton appearance="secondary" size="s" (click)="openFormModal(orcamento)">
                                <tui-icon icon="@tui.edit" [style.height.rem]="1" appearance="secondary"
                                    tuiTooltip="Editar orçamento" aria-label="Editar orçamento" />
                            </button>
                            <button tuiButton appearance="primary" size="s" (click)="confirmClone(orcamento)">
                                <tui-icon icon="@tui.copy" [style.height.rem]="1" appearance="primary"
                                    tuiTooltip="Clonar orçamento" aria-label="Clonar orçamento" />
                            </button>
                            <button tuiButton appearance="destructive" size="s" (click)="confirmDelete(orcamento)">
                                <tui-icon icon="@tui.trash" [style.height.rem]="1" appearance="danger"
                                    tuiTooltip="Excluir orçamento" aria-label="Excluir orçamento" />
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div *ngIf="orcamentos.length === 0" class="empty-state">
                <tui-icon icon="@tui.chart-bar" [style.height.rem]="4" class="empty-icon" />
                <p>Nenhum orçamento encontrado.</p>
                <p>Clique em "Novo Orçamento" para criar seu primeiro orçamento.</p>
            </div>
        </div>
    </div>

    <div *ngIf="isLoading()" class="loading">
        <p>Carregando orçamentos...</p>
    </div>
</div>